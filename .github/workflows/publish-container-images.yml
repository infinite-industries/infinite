name: Publish container images

# initially: limit execution to manual execution
#
# ${{ github.ref_name }} is set to the branch specified, and is used to build &
# tag the container image
on:
  workflow_dispatch

# in the future, execute anytime the development or master branch is updated
#
# ${{ github.ref_name }} is set to the branch name, and is used to build &
# tag the container image
#
#on:
#  push:
#    branches:
#      - master
#      - development

jobs:
  publish-ops-server:
    runs-on: ubuntu-latest
    defaults:
      run:
        shell: bash
        working-directory: ops-server
    steps:
      - name: checkout branch
        uses: actions/checkout@v3
      - name: install casey/just
        uses: extractions/setup-just@v1
        with:
          just-version: 1.13.0
      - name: build the image
        run: just build
      - name: publish the image
        run: just image=infinite-industries/ops registry_user=${{ github.actor }} registry_pass_var=GITHUB_TOKEN publish ${{ github.ref_name }}
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
